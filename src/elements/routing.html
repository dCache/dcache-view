<script src="../bower_components/page/page.js"></script>
<script>
    window.addEventListener('WebComponentsReady', function() {

        /**
         * We use Page.js for routing. This is a Micro client-side router.
         *  More info: https://visionmedia.github.io/page.js/
         *
         * WARNING: This application fully relying on this page,
         * editing it will modified this application behaviour.
         */

        // Removes end / from app.baseUrl which page.base requires for production
        if (window.location.port === '') {  // if production
            page.base(app.baseUrl.replace(/\/$/, ''));
        }

        // Middleware
        window.CONFIG.isSomebody = sessionStorage.upauth != undefined;
        window.CONFIG.homeDirectory = sessionStorage.homeDirectory;
        app.config = window.CONFIG;
        app.organisationName = window.CONFIG["dcache-view.org-name"];


        // Routes
        page('*', function(ctx, next) {
            next();
        });

        page('/', function() {
            app.route = 'home';
            app.params = "";
        });

        page(app.baseUrl, function() {
            app.route = 'home';
            app.params = "";
        });

        page('/admin', function() {
            app.route = 'admin';
            app.params = "";
        });

        page('/admin/:component', function(data) {
            app.route = 'admin-component-page';
            app.params = data.params;
        });

        // 404
        page('*', function() {
            app.$.toast.text = 'Can\'t find: ' + window.location.href  + '. Redirected you to Home Page';
            app.$.toast.show();
            page.redirect(app.baseUrl);
        });

        // add #! before urls
        page({
            hashbang: true
        });

        page({
            decodeURLComponents: true
        });
    });
</script>